\documentclass[pdftex,12pt,letterpaper]{article}

\usepackage[letterpaper,margin=1.0in]{geometry}
\usepackage[pdftex]{graphicx}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{algorithm}
\usepackage{algpseudocode}

\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
\newcommand{\eqdef}{\overset{\text{def}}{=}}
\newcommand{\sign}{\text{\upshape{sign}}}
\newcommand{\suchthat}{\,|\,}

\newtheorem{proposition}{Proposition}
\newtheorem{lemma}{Lemma}
\newtheorem{conjecture}{Conjecture}
\newtheorem{definition}{Definition}

\begin{document}
\title{Humps notes}
\date{}
\maketitle

Nullclines of $\sigma(Wv)-v$:
\begin{align}
\sigma(W_{i,:}v) - v_i &= 0 \\
W_{i,j\ne i}v_{j\ne i} &= \sigma^{-1}(v_i) - W_{i,i}v_i\label{eq:ruled}
\end{align}
Suggests a function $\zeta_i(x) = \sigma^{-1}(x) - W_{i,i}x$.  (\ref{eq:ruled}) implies that nullclines are ``ruled hypersurfaces'': they are a disjoint union of linear spaces, one linear space for each $v_i$.  The $(N-2)$-dimensional linear space for a fixed $v_i = a$ is defined by
\begin{align}
\left[\begin{array}{c} \hat{w}^T \\ I_{i,:}\end{array}\right]v = \left[\begin{array}{c} \zeta_i(a) \\ a\end{array}\right]
\end{align}
where $\hat{w}^T = W_{i,:} - W_{i,i}I_{i,:}$. (proof of disjoint union TODO)

Degenerate case when $\hat{w} = \mathbf{0}^T$:  then only solutions when $\zeta_i(a) = 0$.  Denote the solutions by $\{-a^*, 0, a^*\}$.  Then the nullcline is three disconnected, axis orthogonal hyperplanes satisfying $v_i \in \{-a^*, 0, +a^*\}$. (Humps go to infinity).

``Central points'' on the $i^{th}$ nullcline, for a given $a$: the closest point to $aI_{i,:}^T$.  Of the form $\hat{v} = aI_{i,:}^T + s\hat{w}$ for some $s$.
\begin{align}
\hat{w}^T\hat{v} = \zeta_i(a) \\
\hat{w}^T(aI_{i,:}^T + s\hat{w}) = \zeta_i(a) \\
s\hat{w}^T\hat{w} = \zeta_i(a) \\
s = \zeta_i(a) / (\hat{w}^T\hat{w})
\end{align}

Distance to central points from axis is then calculated to be $|| s\hat{w} || = |\zeta_i(a)| / ||\hat{w}||$, with extremes at
\begin{align}
\zeta_i'(\tilde{a}) = 1 / (1 - \tilde{a}^2) - W_{i,i} = 0 \\
\tilde{a} = \pm \sqrt{1 - 1/W_{i,i}} \\
\end{align}
whenever $W_{i,i} > 1$.  These extremities are refered to as ``humps''.  Here, the distance $|\zeta_i(\tilde{a})| / ||\hat{w}||$ is large when
\begin{align}
|\zeta_i(\tilde{a})|/||\hat{w}||
&= |\sigma^{-1}(\sqrt{1 - 1/W_{i,i}}) - W_{i,i}\sqrt{1 - 1/W_{i,i}}|/||\hat{w}||
\end{align}
is large.  In particular, for a desired $\tilde{a}$, $W_{i,i}$ can be set to $1 / (1 - \tilde{a}^2)$.  And for fixed $W_{i,i}$, rescaling the off-diagonals can make the humps arbitrarily large or small.

\begin{figure}
\centering
\includegraphics[width=.5\textwidth]{hump.eps}
%% \includegraphics[width=.5\textwidth]{hump.png}
\caption{Generated by \texttt{humps.m}.}
\end{figure}

For any given hypercorner $v \in \{-1,1\}^N$, and any particular $i^{th}$ nullcline, we will want to know the direction of the closer of the two humps.  For $W_{i,i}>1$, inspection shows that $\sign(s) = \sign(\zeta_i(\tilde{a})) = -\sign(\tilde{a})$ (Fig. \ref{fig:zeta}).

\begin{figure}
\centering
\includegraphics[width=.4\textwidth]{zeta.eps}
\caption{Generated by \texttt{zetas.py}. Plots $\zeta_i(a)$ over $a$ for $W_{i,i}>1$.}
\label{fig:zeta}
\end{figure}

An ``opening'' is the space between a hump and the vertices it points towards.  If a hypercorner is in the opening of the closer hump in the $i^{th}$ nullcline, then $v_i$ is subject to change sign (proof TODO).  Given the hump vector $s\hat{w}$, its opening is the set of $\nu\in[-1,1]^N$ whose orthogonal projection onto $s\hat{w}$ is farther in the direction of $s\hat{w}$ than $s\hat{w}$ itself. Formally, the unit direction vector of $s\hat{w}$ is $\sign(s)\hat{w}/||\hat{w}|| = -\sign(v_i)\hat{w}/||\hat{w}||$, and the length is $\sqrt{\zeta_i(\tilde{a})^2\hat{w}^T\hat{w}/(\hat{w}^T\hat{w})^2} = |\zeta_i(\tilde{a})|/||\hat{w}||$, so the opening is
\begin{align}
[-1,1]^N \cap \{\nu : -\sign(v_i)\hat{w}^T\nu > |\zeta_i(\tilde{a})| \}
\end{align}
In a simple special case, the opening contains $v$ if $-\sign(v_i)\hat{w}^Tv > |\zeta_i(\tilde{a})|$.

TODO \texttt{opening.m} for visualization to help remember

Given two vertices $v^x$ and $v^y$, let $i^\Box$ denote the indices where $v^x$ and $v^y$ match sign, and $i^\Delta$ the indices where they do not.  A ``transit'' from $v^x$ to $v^y$ is a dynamical trajectory from $v^x$ to $v^y$ along which $v^x_{i^\Delta}$ change sign but $v^x_{i^\Box}$ do not.  A transit should exist if $v^x$ is in the opening for each $i^\Delta$ and not in the opening for any $i^\Box$ (proof TODO).  Formally this condition is a set of linear inequalities in the $\hat{w}_i$:
\begin{align}
%% \forall i\in i^\Delta:& -\sign(v^x_i)\hat{w}^T_iv^x > |\zeta_i(\tilde{a})| \\
\forall i\in i^\Delta:& \sign(v^x_i)\hat{w}^T_iv^x < -|\zeta_i(\tilde{a})| \\
\forall i\in i^\Box:& -\sign(v^x_i)\hat{w}^T_iv^x < |\zeta_i(\tilde{a})| \\
\end{align}
Multiple transits lead to multiple inequalities for each $\hat{w_i}$, i.e., $N$ independent linear feasibility programs.


\end{document}

